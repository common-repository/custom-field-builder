window.CFBuilder={},jQuery,window.CFBuilder.media=function(t){let e=t.find(".j-media-preview"),i=t.find(".j-media-value"),o=t.find(".j-media-add"),s=t.find(".j-media-remove"),n=null;o.on("click",function(t){t.preventDefault(),n?n.open():((n=wp.media({title:"Select or Upload Media Of Your Chosen Persuasion",button:{text:"Use this media"},multiple:!1})).on("select",function(){let t=n.state().get("selection").first().toJSON();e.css("background-image",`url('${t.url}')`),i.val(t.id)}),n.open())}),s.on("click",function(t){t.preventDefault(),e.removeAttr("style"),i.val("")})},function(t){let e=function(e){let i=this;i.$container=e,i.$posts=e.find(".j-cfb-relationship-posts"),i.$searchResult=e.find(".j-cfb-relationship-result"),i.$search=e.find(".j-cfb-relationship-search"),i.$value=e.find(".j-cfb-relationship-value"),i.timer=null,i.xhr=null,i.posts=[],t.each(i.$container.find(".cfb-post-relationship__post"),function(e,o){i.addPost(t(o))}),i.savePostsToInput(),i.$container.on("click",".j-cfb-relationship-result-item",function(){let e=t(this);i.addPost(e)&&(i.addPostHtml(e),i.savePostsToInput())}),i.$container.on("click",".j-cfb-relationship-remove",function(){i.removePost(t(this).closest(".cfb-post-relationship__post")),i.savePostsToInput()}),i.$search.on("input",function(){i.cancelRequest(),i.$search.val().length<=2?i.$search.parent().removeClass("cfb-post-relationship__search--loading"):i.timer=setTimeout(function(){i.searchPosts()},200)})};e.prototype.cancelRequest=function(){let t=this;t.timer&&(clearTimeout(t.timer),t.timer=null),t.xhr&&(t.xhr.abort(),t.xhr=null)},e.prototype.savePostsToInput=function(){let t=this,e="";for(let i=0;i<t.posts.length;i++)e+=(i>0?", ":"")+t.posts[i].id;t.$value.val(e)},e.prototype.searchPosts=function(){let e=this;e.$search.parent().addClass("cfb-post-relationship__search--loading"),e.xhr=t.ajax({method:"GET",url:ajaxurl,data:{action:"cfb_relationship_find_entities",title:e.$search.val()},dataType:"json",success:function(t){if(e.$search.parent().removeClass("cfb-post-relationship__search--loading"),!t.posts)return;let i="";for(let o=0;o<t.posts.length;o++)i+=e.getSearchItemHtml(t.posts[o].id,t.posts[o].title,t.posts[o].thumb);e.$searchResult.html(i)}})},e.prototype.addPost=function(t){let e=t.data("post-id"),i=t.data("post-title"),o=t.data("post-img");return!this.findPost(e)&&(this.posts.push({id:e,title:i,img:o}),!0)},e.prototype.addPostHtml=function(t){let e=t.data("post-id"),i=t.data("post-title"),o=t.data("post-img"),s=`\n      <div class="cfb-post-relationship__post" data-post-id="${e}" data-post-title="${i}" data-post-img="${o}">\n        <img src="${o}" class="cfb-post-relationship__post-img">\n        <span class="cfb-post-relationship__post-title">${i}</span>\n        <button class="cfb-post-relationship__post-remove j-cfb-relationship-remove"></button>\n      </div>\n    `;this.$posts.append(s)},e.prototype.removePost=function(t){let e=this,i=t.data("post-id"),o=(t.data("post-title"),t.data("post-img"),[]);for(;e.posts.length;){let t=e.posts.pop(e.posts);t.id!=i&&o.push(t)}e.posts=o,t.remove()},e.prototype.getSearchItemHtml=function(t,e,i){return`\n      <div class="cfb-post-relationship__result j-cfb-relationship-result-item" data-post-id="${t}" data-post-title="${e}" data-post-img="${i}">\n        <img src="${i}" class="cfb-post-relationship__result-img">\n        <span class="cfb-post-relationship__result-title">${e}</span>\n      </div>\n    `},e.prototype.findPost=function(t){let e=this;for(let i=0;i<e.posts.length;i++)if(e.posts[i].id==t)return e.posts[i];return null},window.CFBuilder.postRelationship=e}(jQuery),function(t){let e=function(e){let i=this;i.$items=e.find(".j-repeater-items"),i.$add=e.find(".j-repeater-add"),i.$template=t("#"+i.$add.data("template")),i.itemsCount=i.$items.children().length,i.$add.on("click",function(e){e.preventDefault();let o=t(i.$template.html().replace(/\{\{id\}\}/g,i.itemsCount++));i.$items.append(o),i.initComponents(o),i.initToggler(o)}),e.on("click",".j-repeater-remove",function(e){e.preventDefault(),t(this).closest(".j-repeater-item").remove()}),t.each(i.$items.children(),function(e,o){i.initToggler(t(o))})};e.prototype.initComponents=function(e){t.each(e.find(".j-media"),function(e,i){new window.CFBuilder.media(t(i))}),t.each(e.find(".j-color-picker"),function(e,i){t(i).wpColorPicker()}),t.each(e.find(".cfb-post-relationship"),function(e,i){new CFBuilder.postRelationship(t(i))})},e.prototype.initToggler=function(t){let e=t.children(".j-repeater-item-title"),i=t.children(".j-repeater-item-content"),o=i.outerHeight();e.on("click",function(){i.hasClass("cfb-repeater__item-content--active")?(i.css("height",0),i.removeClass("cfb-repeater__item-content--active"),e.removeClass("cfb-repeater__item-title--active")):(i.css("height",o),i.addClass("cfb-repeater__item-content--active"),e.addClass("cfb-repeater__item-title--active"))}),i.hasClass("cfb-repeater__item-content--active")||i.css("height",0)},window.CFBuilder.repeater=e}(jQuery),function(t){t(function(){t.each(t(".j-media"),function(e,i){new CFBuilder.media(t(i))}),t(".j-color-picker").wpColorPicker(),t.each(t(".j-repeater"),function(e,i){new CFBuilder.repeater(t(i))}),t.each(t(".cfb-post-relationship"),function(e,i){new CFBuilder.postRelationship(t(i))});let e=function(e){let i=e.children(".j-checkbox-group-value"),o="";t.each(e.find(".j-checkbox-group-item"),function(e,i){t(i).children("input").attr("checked")&&(o+=t(i).children("input").val()+", ")}),o=o.slice(0,o.length-2),i.val(o)};t("body").on("click",".j-checkbox-group-item",function(i){t(this).is("input")||e(t(this).closest(".j-checkbox-group"))}),t.each(t(".j-checkbox-group"),function(i,o){e(t(o))})})}(jQuery);